define(["view/base","jquery-validate"],function(s){var e=s.extend({el:".settings",events:{"click .saveSettings":"saveSettings","click .saveCloseSettings":"saveCloseSettings"},initialize:function(s){_.bindAll(this,"saveSettings","saveCloseSettings","render"),this.user=s.user,this.templar=s.templar},render:function(){this.templar.render({path:"settings",el:this.$el,data:{user:this.user.toJSON()}}),this.$modal=this.$el.find(".settings"),this.resizeModal($("#settings"),"small",!0)},saveSettings:function(){this.user.updatePrefs({alertKeys:this.parseAlertKeys(this.$el.find(".alert-settings textarea").val())})},saveCloseSettings:function(){this.saveSettings(),this.$modal.modal("hide")},setSettingsValidation:function(){this.form=$("#addDashboardForm"),this.validator=this.form.validate({rules:{dashboardName:{required:!0}},highlight:function(s){$(s).closest(".control-group").addClass("error")},success:function(s){s.closest(".control-group").removeClass("error"),$(s).remove()},submitHandler:function(){this.close?this.saveFinish():this.save()}.bind(this)})},checkValidation:function(){this.close=!1,this.form.submit()},checkValidationClose:function(){this.close=!0,this.form.submit()},save:function(){this._saveDashboard(function(){this._cleanUp()}.bind(this))},saveFinish:function(){this._saveDashboard(function(){this._closeModal()}.bind(this))},destructor:function(){var s=this.$el.prev();this.remove(),this.off(),this.$el=$("<section class='settings-wrap'></section>").insertAfter(s)},_saveDashboard:function(s){this.model.save({userId:this.user.get("id"),name:this.$el.find("#dashboardName").val(),description:this.$el.find("#dashboardDescription").val()},{success:function(e){this.collection.add(e),Backbone.Mediator.pub("view:adddashboard:save",{model:e,message:"The dashboard '"+e.get("name")+"' was added.",attention:"Dashboard Saved!"}),"function"==typeof s&&s()}.bind(this),error:function(){this.validator.showErrors({dashboardName:"That dashboard name already exists!"})}.bind(this)})},_closeModal:function(){this._cleanUp(),this.$modal.modal("hide")},_cleanUp:function(){this.$el.find("#dashboardName").val(""),this.$el.find("#dashboardDescription").val(""),this.$el.find("#dashboardName").parent().removeClass("error"),this.validator.resetForm(),this.model=new DashboardModel}});return e});