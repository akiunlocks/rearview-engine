ModeTest={},ModeTest.modeOptions={},ModeTest.modeName=CodeMirror.defaults.mode,ModeTest.testCount=0,ModeTest.passes=0,ModeTest.testMode=function(t,e,s,r,o,n){ModeTest.testCount+=1,r||(r=ModeTest.modeName),o||(o=ModeTest.modeOptions);var a=CodeMirror.getMode(o,r);if(s.length<0)throw"must have text for test ("+t+")";if(s.length%2!=0)throw"must have text for test ("+t+") plus expected (style, token) pairs";return test(r+"_"+t,function(){return ModeTest.compare(e,s,a)},n)},ModeTest.compare=function(t,e,s){for(var r=[],o=0;o<e.length;o+=2)e[o]=null!=e[o]?e[o].split(" ").sort().join(" "):e[o],r.push([e[o],e[o+1]]);var n,a=ModeTest.highlight(t,s),l="";r.length>0&&(n=ModeTest.highlightOutputsEqual(r,a),l=n?"mt-pass":"mt-fail",ModeTest.passes+=n?1:0);var d="";if(n||0==r.length)return d+='<div class="mt-test '+l+'">',d+="<pre>"+ModeTest.htmlEscape(t)+"</pre>",d+='<div class="cm-s-default">',d+=ModeTest.prettyPrintOutputTable(a),d+="</div>",d+="</div>";throw d+='<div class="mt-test '+l+'">',d+="<pre>"+ModeTest.htmlEscape(t)+"</pre>",d+='<div class="cm-s-default">',d+="expected:",d+=ModeTest.prettyPrintOutputTable(r),d+="observed:",d+=ModeTest.prettyPrintOutputTable(a),d+="</div>",d+="</div>"},ModeTest.highlight=function(t,e){for(var s=e.startState(),r=t.replace(/\r\n/g,"\n").split("\n"),o=[],n=0;n<r.length;++n){var a=r[n],l=new CodeMirror.StringStream(a);""==a&&e.blankLine&&e.blankLine(s);for(var d=0,i=[];!l.eol();){var p=e.token(l,s),u=l.current();if(l.start=l.pos,d&&i[d-1]==p?i[d-2]+=u:u&&(i[d++]=u,i[d++]=p),l.pos>5e3){i[d++]=this.text.slice(l.pos),i[d++]=null;break}}for(var c=0;c<i.length;c+=2)i[c+1]=null!=i[c+1]?i[c+1].split(" ").sort().join(" "):i[c+1],o.push([i[c+1],i[c]])}return o},ModeTest.highlightOutputsEqual=function(t,e){var s=t.length==e.length;if(s)for(var r in t)s=s&&2==t[r].length&&t[r][0]==e[r][0]&&t[r][1]==e[r][1];return s},ModeTest.prettyPrintOutputTable=function(t){var e='<table class="mt-output">';e+="<tr>";for(var s=0;s<t.length;++s){var r=t[s];e+='<td class="mt-token"><span class="cm-'+String(r[0]).replace(/ +/g," cm-")+'">'+ModeTest.htmlEscape(r[1]).replace(/ /g,"&middot;")+"</span></td>"}e+="</tr><tr>";for(var s=0;s<t.length;++s){var r=t[s];e+='<td class="mt-style"><span>'+r[0]+"</span></td>"}return e+="</table>"},ModeTest.printSummary=function(){ModeTest.runTests(ModeTest.displayTest),document.write(ModeTest.passes+" passes for "+ModeTest.testCount+" tests")},ModeTest.htmlEscape=function(t){return t=t.toString(),t.replace(/[<&]/g,function(t){return"&"==t?"&amp;":"&lt;"})};